version: "2"

run:
  timeout: 5m
  concurrency: 4
  tests: true
  modules-download-mode: readonly

linters:
  default: none
  enable:
    # --- Core correctness ---
    - govet
    - errcheck
    - staticcheck
    - ineffassign
    - unused
    - unconvert
    - unparam
    - errorlint
    - nilerr
    - bodyclose

    # --- Code quality & style ---
    - revive
    - gocritic
    - gocyclo
    - nakedret
    - lll
    - misspell
    - whitespace
    - asciicheck

    # --- Safety & performance ---
    - copyloopvar
    - exhaustive
    - makezero
    - prealloc
    - reassign
    - rowserrcheck
    - sqlclosecheck
    - contextcheck

    # --- Dependency discipline ---
    - depguard
    - gomodguard
    - forbidigo
    - nolintlint

    # --- Testing ---
    - testifylint
    - tparallel

  settings:
    gocyclo:
      min-complexity: 15

    lll:
      line-length: 200
      tab-width: 2

    revive:
      severity: warning
      rules:
        - name: blank-imports
        - name: context-as-argument
        - name: context-keys-type
        - name: early-return
        - name: errorf
        - name: error-return
        - name: increment-decrement
        - name: range
        - name: receiver-naming
        - name: var-declaration
        - name: var-naming
        - name: unexported-return
        - name: exported
        - name: line-length-limit
          arguments: [200]
        - name: package-comments
          disabled: true # apps â‰  libraries

    gocritic:
      enabled-tags:
        - diagnostic
        - opinionated
        - performance
        - style
      disabled-checks:
        - unnamedResult
        - whyNoLint
        - paramTypeCombine

    depguard:
      rules:
        all:
          deny:
            - pkg: io/ioutil
              desc: "io/ioutil is deprecated"
            - pkg: github.com/pkg/errors
              desc: "use stdlib errors"
            - pkg: golang.org/x/exp/maps
              desc: "use stdlib maps"
            - pkg: golang.org/x/exp/slices
              desc: "use stdlib slices"
            - pkg: gopkg.in/yaml.v2
              desc: "use yaml.v3"

    forbidigo:
      analyze-types: true
      forbid:
        - pattern: 'context\.Background'
          pkg: "^context$"
          msg: "Do not use context.Background in request code"
        - pattern: 'context\.TODO'
          pkg: "^context$"
          msg: "Do not ship TODO contexts"

    gomodguard:
      blocked:
        modules:
          - github.com/pkg/errors:
              recommendations:
                - errors
                - fmt
        versions:
          - gotest.tools:
              version: < 3.0.0
              reason: "deprecated pre-modules version"

issues:
  max-issues-per-linter: 0
  max-same-issues: 0

formatters:
  enable:
    - gofumpt
    - gci

  settings:
    gci:
      custom-order: true
      sections:
        - standard
        - default
        - localmodule

  exclusions:
    generated: lax
    paths:
      - third_party$
      - vendor$
      - examples$
